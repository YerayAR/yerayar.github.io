const ready=e=>"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e();ready(()=>{const t=document.documentElement,n=document.getElementById("theme-toggle"),o=document.getElementById("theme-icon"),a="yar-theme-preference",l=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)"),r=e=>{t.setAttribute("data-theme",e),localStorage.setItem(a,e),n&&n.setAttribute("aria-label","dark"===e?"Cambiar a tema claro":"Cambiar a tema oscuro"),o&&(o.dataset.state=e),document.dispatchEvent(new CustomEvent("themechange",{detail:e}))},c=localStorage.getItem(a)||(l&&l.matches?"dark":"light");r(c),l&&"function"==typeof l.addEventListener&&l.addEventListener("change",e=>{localStorage.getItem(a)||r(e.matches?"dark":"light")}),n&&n.addEventListener("click",()=>{r("dark"===t.getAttribute("data-theme")?"light":"dark")});const s=document.getElementById("menu-toggle"),i=document.querySelector(".nav-menu");if(s&&i){s.addEventListener("click",()=>i.classList.toggle("active")),document.addEventListener("click",e=>{e.target.closest(".nav-menu")||e.target.closest("#menu-toggle")||i.classList.remove("active")});const e=i.querySelectorAll('a[href^="#"]');e.forEach(e=>{e.addEventListener("click",l=>{const r=e.getAttribute("href");if(!r||"#"===r)return;l.preventDefault(),i.classList.remove("active");const c=document.querySelector(r);if(!c)return;const s=document.querySelector(".site-header"),n=s?s.offsetHeight+12:0,o=c.getBoundingClientRect().top+window.pageYOffset-n;window.scrollTo({top:o,behavior:"smooth"})})})}const d=document.getElementById("contactForm");if(d){const e=window.emailjs;e&&function(){try{e.init({publicKey:"lowkfjPI5RGmYIDmM"})}catch(e){console.warn("EmailJS init error",e)}}(),d.addEventListener("submit",t=>{t.preventDefault();const n=new FormData(d),o={from_name:n.get("name"),from_email:n.get("email"),message:n.get("message")};if(!o.from_name||!o.from_email||!o.message)return;d.classList.add("is-loading"),e?e.send("service_mk372rb","template_u3yoceu",o).then(()=>{alert("Gracias por tu mensaje. Te responder\u00e9 muy pronto."),d.reset(),d.classList.remove("is-loading")}).catch(t=>{console.error(t),alert("No se pudo enviar el mensaje. Int\u00e9ntalo nuevamente m\u00e1s tarde."),d.classList.remove("is-loading")}):(alert("El servicio de correo no est\u00e1 disponible temporalmente."),d.classList.remove("is-loading"))})}const u=document.getElementById("repo-list"),h=async()=>{if(!u)return;u.textContent="Cargando repositorios...";try{const e=await fetch("https://api.github.com/users/YerayAR/repos?per_page=100");if(!e.ok)throw new Error("request failed");const t=await e.json(),n=t.filter(e=>!e.fork).sort((e,t)=>new Date(t.pushed_at)-new Date(e.pushed_at)).slice(0,6);if(u.textContent="",!n.length)return void(u.textContent="Pronto actualizar\u00e9 mis repositorios destacados.");n.forEach(e=>{const t=document.createElement("article");t.className="repo-item";const n=e.description?e.description:"Repositorio sin descripci\u00f3n.";t.innerHTML=`<h3><a href="${e.html_url}" target="_blank" rel="noopener">${e.name}</a></h3><p>${n}</p>`,u.appendChild(t)})}catch(e){console.error("Error al obtener repositorios",e),u.textContent="No se pudieron cargar los repositorios en este momento."}};h();const m=document.querySelectorAll(".bubble-layer");m.forEach(e=>{if(!e.getContext)return;const n=e.getContext("2d"),o=[],a={count:20,minRadius:5,maxRadius:18,minSpeed:.2,maxSpeed:.8,minDrift:-.12,maxDrift:.12};let l=0,r=0,c=null;const s=(e,t)=>Math.random()*(t-e)+e,i=(e=!1)=>{o.push({x:Math.random()*l,y:e?Math.random()*r:r+s(0,60),radius:s(a.minRadius,a.maxRadius),speed:s(a.minSpeed,a.maxSpeed),drift:s(a.minDrift,a.maxDrift)})},d=()=>{const t=window.devicePixelRatio||1,u=e.getBoundingClientRect();l=u.width||e.offsetWidth,r=u.height||e.offsetHeight,e.width=Math.round(l*t),e.height=Math.round(r*t),n.setTransform(1,0,0,1,0,0),n.scale(t,t),o.length=0;for(let e=0;e<a.count;e++)i(!0)},u=()=>{const t="dark"===document.documentElement.getAttribute("data-theme")?"rgba(56,189,248,.13)":"rgba(37,99,235,.12)";n.clearRect(0,0,l,r),o.forEach(e=>{e.y-=e.speed,e.x+=e.drift,(e.y+e.radius<0||e.x<-e.radius||e.x>l+e.radius)&&(e.x=Math.random()*l,e.y=r+s(0,60),e.radius=s(a.minRadius,a.maxRadius),e.speed=s(a.minSpeed,a.maxSpeed),e.drift=s(a.minDrift,a.maxDrift)),n.beginPath(),n.fillStyle=t,n.arc(e.x,e.y,e.radius,0,2*Math.PI),n.fill()}),c=requestAnimationFrame(u)};d();const h="ResizeObserver"in window?new ResizeObserver(d):null;h?h.observe(e):window.addEventListener("resize",d,{passive:!0}),c&&cancelAnimationFrame(c),u(),document.addEventListener("themechange",()=>{n.clearRect(0,0,l,r)})});const p=document.querySelectorAll(".section");if(p.length){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("is-visible"),e.unobserve(t.target))})},{threshold:.2});p.forEach(t=>{t.classList.contains("hero-section")?t.classList.add("is-visible"):e.observe(t)})}const f=document.getElementById("visitCount");if(f){const e=parseInt(localStorage.getItem("yar-visit-count")||"0",10)+1;localStorage.setItem("yar-visit-count",`${e}`),f.textContent=e.toLocaleString("es-ES")}const g=document.getElementById("currentYear");g&&(g.textContent=`${new Date().getFullYear()}`)});
